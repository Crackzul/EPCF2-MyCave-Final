<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard ‚Äì MyCave</title>
    <link rel="stylesheet" href="{{ asset('assets/css/style.css') }}" />
</head>
<body class="dashboard">
    <header class="dashboard-header">
        <div class="header-content">
            <img src="{{ asset('assets/img/logo-large.png') }}" alt="myCAVE logo" class="logo">
            <div class="header-text">
                <h1>Bienvenue dans votre cave {{ user.name }}</h1>
                <p>Elle contient d√©j√† <span id="bottle-count">0</span> bouteilles</p>
            </div>
            <div class="header-actions">
                <button class="btn-primary" onclick="window.location.href='{{ path('app_add_wine') }}'">
                    Ajouter une nouvelle bouteille
                </button>
                <button class="btn-outline" onclick="window.location.href='{{ path('app_logout') }}'">
                    D√©connexion
                </button>
            </div>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="background-cave">
            <img src="{{ asset('assets/img/pexels-finn-ruijter-2153149058-32906672.jpg') }}" alt="Image cave" class="cave-image">
        </div>
        <div class="wines-container" id="wines-container">
            <div class="loading" style="text-align: center; color: white; font-size: 1.2rem; margin: 2rem;">
                üç∑ Chargement de votre cave...
            </div>
        </div>
    </main>

    <footer class="dashboard-footer">
        <p>¬© 2025 MyCave - Votre cave √† vin digitale</p>
    </footer>

    <script>
        let currentUser = {{ user|json_encode|raw }};

        // Charger les bouteilles au chargement de la page
        document.addEventListener('DOMContentLoaded', async () => {
            await loadWines();
        });

        // Charger les bouteilles depuis l'API
        async function loadWines() {
            try {
                const response = await fetch('{{ path('app_api_wines') }}');
                const data = await response.json();
                
                if (data.success) {
                    displayWines(data.wines);
                    updateBottleCount(data.count);
                } else {
                    showError('Erreur lors du chargement des bouteilles');
                }
            } catch (error) {
                showError('Erreur de connexion');
                console.error('Erreur:', error);
            }
        }

        // Afficher les bouteilles
        function displayWines(wines) {
            const container = document.getElementById('wines-container');
            
            if (wines.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: white; padding: 3rem;">
                        <h3 style="margin-bottom: 1rem;">üç∑ Votre cave est vide</h3>
                        <p style="margin-bottom: 2rem;">Commencez par ajouter votre premi√®re bouteille !</p>
                        <button class="btn-primary" onclick="window.location.href='{{ path('app_add_wine') }}'">
                            Ajouter une bouteille
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = wines.map(wine => createWineCard(wine)).join('');
        }

        // Cr√©er une carte de vin
        function createWineCard(wine) {
            return `
                <div class="wine-card" data-wine-id="${wine.id}">
                    <div class="wine-image">
                        <img src="${wine.image || '{{ asset('assets/img/default-wine.jpg') }}'}" alt="${wine.name}">
                    </div>
                    <div class="wine-info">
                        <h3>${wine.name}</h3>
                        <p class="wine-year">${wine.year}</p>
                        <p class="wine-country">${wine.country}</p>
                        <p class="wine-price">${wine.price}‚Ç¨</p>
                    </div>
                    <div class="wine-actions">
                        <button onclick="editWine(${wine.id})" class="btn-edit">Modifier</button>
                        <button onclick="deleteWine(${wine.id})" class="btn-delete">Supprimer</button>
                    </div>
                </div>
            `;
        }

        function updateBottleCount(count) {
            document.getElementById('bottle-count').textContent = count;
        }

        function showError(message) {
            const container = document.getElementById('wines-container');
            container.innerHTML = `
                <div style="text-align: center; color: white; padding: 3rem;">
                    <h3 style="margin-bottom: 1rem;">‚ùå Erreur</h3>
                    <p>${message}</p>
                </div>
            `;
        }
    </script>
</body>
</html> 